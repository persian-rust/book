# پروژه نهایی: ساخت یک وب سرور چندنخی

مسیر طولانی‌ای را طی کرده‌ایم، اما اکنون به انتهای کتاب رسیده‌ایم. در این فصل، یک پروژه دیگر را با هم می‌سازیم تا برخی از مفاهیمی که در فصل‌های پایانی پوشش داده‌ایم را نشان دهیم و همچنین درس‌های قبلی را مرور کنیم.

برای پروژه نهایی، یک وب سرور ایجاد می‌کنیم که عبارت "hello" را نمایش دهد و در یک مرورگر وب شبیه شکل 21-1 به نظر برسد.

![hello from rust](img/trpl21-01.png)

<span class="caption">شکل 21-1: پروژه نهایی ما</span>

برنامه ما برای ساخت وب سرور به این صورت است:

<div dir="rtl">
    <ul>
        <li>کمی درباره TCP و HTTP یاد می‌گیریم.</li>
        <li>گوش دادن به اتصالات TCP روی یک سوکت را پیاده‌سازی می‌کنیم.</li>
        <li>تعداد کمی از درخواست‌های HTTP را تجزیه می‌کنیم.</li>
        <li>یک پاسخ HTTP مناسب ایجاد می‌کنیم.</li>
        <li>با استفاده از یک مجموعه نخ (thread pool) توان عملیاتی سرور را بهبود می‌بخشیم.</li>
    </ul>
</div>

![hello from rust](img/trpl21-01.png)

<span class="caption">شکل ۲۱-۱: پروژه نهایی مشترک ما</span>

پیش از شروع، باید به دو نکته اشاره کنیم. اول اینکه روشی که در این فصل استفاده خواهیم کرد، بهترین راه برای ساخت یک وب‌سرور با Rust نیست. اعضای جامعه کاربری، کرِیت‌هایی در سطح تولید (production-ready) منتشر کرده‌اند که در [crates.io](https://crates.io/) در دسترس‌اند و پیاده‌سازی‌های کامل‌تری از وب‌سرور و استخر نخ (thread pool) نسبت به چیزی که ما خواهیم ساخت ارائه می‌دهند. با این حال، هدف ما در این فصل آموزش دادن است، نه انتخاب ساده‌ترین مسیر. از آن‌جا که Rust یک زبان برنامه‌نویسی سیستمی است، می‌توانیم سطح انتزاعی که می‌خواهیم با آن کار کنیم را انتخاب کنیم و حتی به سطحی پایین‌تر برویم؛ چیزی که در زبان‌های دیگر یا ممکن نیست یا در عمل کاربردی ندارد.

قبل از شروع، باید به دو نکته اشاره کنیم: اول، روشی که استفاده خواهیم کرد بهترین روش برای ساخت یک وب سرور با Rust نخواهد بود. اعضای جامعه Rust تعداد زیادی crate آماده تولید در [crates.io](https://crates.io/) منتشر کرده‌اند که پیاده‌سازی‌های کامل‌تری از وب سرور و مجموعه نخ نسبت به آنچه که ما خواهیم ساخت ارائه می‌دهند. با این حال، هدف ما در این فصل کمک به یادگیری شماست، نه انتخاب مسیر آسان. از آنجا که Rust یک زبان برنامه‌نویسی سیستمی است، می‌توانیم سطح انتزاعی که می‌خواهیم با آن کار کنیم را انتخاب کنیم و به سطح پایین‌تری از آنچه در زبان‌های دیگر ممکن یا عملی است برویم.

دوم، ما اینجا از async و await استفاده نخواهیم کرد. ساخت یک مجموعه نخ به اندازه کافی چالش‌برانگیز است، بدون اینکه به ایجاد یک runtime async اضافه شود! با این حال، اشاره خواهیم کرد که async و await چگونه ممکن است برای برخی از همان مشکلاتی که در این فصل خواهیم دید کاربرد داشته باشند. در نهایت، همان‌طور که در فصل 17 ذکر کردیم، بسیاری از runtime‌های async از مجموعه نخ برای مدیریت کارهای خود استفاده می‌کنند.

بنابراین، سرور HTTP ساده و مجموعه نخ را به صورت دستی خواهیم نوشت تا بتوانید ایده‌ها و تکنیک‌های کلی پشت جعبه‌ها (crates)یی که ممکن است در آینده استفاده کنید را یاد بگیرید.
